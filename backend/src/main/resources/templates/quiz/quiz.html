<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë‹¨ë‹µí˜• í€´ì¦ˆ</title>
    <link rel="stylesheet" href="/css/quiz.css">

    <!-- userIdë¥¼ JSì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì„¤ì • -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        window.userId = [[${userId}]];
        window.userNickname = [[${userNickname}]];
        /*]]>*/
    </script>
</head>
<body style="margin: 0; font-family: 'Noto Sans KR', sans-serif; background-color: #f5f5f5;">
<div style="display: flex; height: 100vh;">

    <!-- ì¢Œì¸¡: í€´ì¦ˆ ì˜ì—­ -->
    <div style="flex: 2; padding: 40px;">
        <h1>ğŸ“‹ ë‹¨ë‹µí˜• ë‹¨ì–´ í€´ì¦ˆ</h1>
        <form id="quizForm">
            <div id="quizList">
                <!-- JSë¡œ ì±„ì›Œì§ -->
            </div>
            <button type="submit" style="margin-top: 20px;">ì œì¶œí•˜ê¸°</button>
        </form>
    </div>

    <!-- ìš°ì¸¡: ìœ ì € ë±ƒì§€ ìë¦¬ -->
    <div style="flex: 1; padding: 20px; background-color: #e9f0f8;">
        <h3>ğŸ… ë‚˜ì˜ ë ˆë²¨ í˜„í™©</h3>
        <div id="badgeContainer">
            <!-- ë±ƒì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
    </div>
</div>

<script>
    // í˜„ì¬ íšë“í•œ ë±ƒì§€ ì´ë¦„ë“¤ ê¸°ë¡
    let earnedBadgeNames = new Set();

    window.onload = async function () {
        if (!window.userId) {
            alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.');
            location.href = '/login';
            return;
        }

        const badgeContainer = document.getElementById('badgeContainer');

        // --- ì´ˆê¸° ë±ƒì§€ ë¡œë“œ ---
        try {
            const pointsResponse = await fetch(`/api/users/${window.userId}/points`);
            let userPoints = 0;
            if (pointsResponse.ok) {
                const pointsData = await pointsResponse.json();
                userPoints = pointsData.totalPoints || 0;
            }

            const badgeResponse = await fetch(`/api/users/${window.userId}/badges`);
            if (badgeResponse.ok) {
                const badges = await badgeResponse.json();
                const earnedBadges = badges.filter(b => b.earned);
                earnedBadgeNames = new Set(earnedBadges.map(b => b.name));

                if (earnedBadges.length > 0) {
                    // í˜„ì¬ ë“±ê¸‰ í—¤ë”
                    const rankOrder = ['ë¸Œë¡ ì¦ˆ','ì‹¤ë²„','ê³¨ë“œ','í”Œë˜í‹°ë„˜'];
                    const currentRank = earnedBadges
                        .filter(b => rankOrder.includes(b.name))
                        .sort((a,b) => rankOrder.indexOf(b.name) - rankOrder.indexOf(a.name))[0];
                    if (currentRank) {
                        const header = document.createElement('div');
                        header.style.cssText = 'margin-bottom:10px; padding:8px 10px; background:#fff; border:1px solid #eee; border-radius:8px; display:flex; align-items:center; gap:10px;';
                        const img = document.createElement('img');
                        img.src = currentRank.imageUrl; img.alt = currentRank.name; img.style.cssText = 'width:36px; height:36px; object-fit:contain;';
                        const title = document.createElement('div');
                        title.innerHTML = `<strong>í˜„ì¬ ë“±ê¸‰:</strong> ${currentRank.name}`;
                        header.appendChild(img); header.appendChild(title);
                        badgeContainer.appendChild(header);
                    }

                    // ë±ƒì§€ í‘œì‹œ
                    earnedBadges.forEach(badge => {
                        const badgeDiv = document.createElement('div');
                        badgeDiv.style.cssText = `
                            display: inline-block;
                            margin: 5px;
                            text-align: center;
                            padding: 10px;
                            border-radius: 8px;
                            background: #ffffff;
                            color: #333;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.12);
                            border: 1px solid #eee;
                        `;
                        const img = document.createElement('img');
                        img.src = badge.imageUrl;
                        img.alt = badge.name;
                        img.style.cssText = 'width: 160px; height: 160px; margin-bottom: 12px; filter: none; object-fit: contain;';
                        badgeDiv.appendChild(img);
                        const nameDiv = document.createElement('div');
                        nameDiv.textContent = badge.name;
                        nameDiv.style.cssText = 'font-size: 16px; font-weight: bold; margin-bottom: 5px;';
                        badgeDiv.appendChild(nameDiv);
                        badgeContainer.appendChild(badgeDiv);
                    });

                    // âœ… ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ë¥  í‘œì‹œ
                    const next = badges.filter(b => !b.earned).sort((a,b)=>a.conditionValue-b.conditionValue)[0];
                    if (next) {
                        const wrap = document.createElement('div');
                        wrap.style.cssText = 'margin-top:8px; background:#fff; border:1px solid #eee; border-radius:8px; padding:10px;';
                        const progress = Math.min(100, (userPoints / next.conditionValue) * 100);
                        wrap.innerHTML = `
                            <div style="font-size: 12px; margin-bottom: 3px; color: #333;">ë‹¤ìŒ ë‹¨ê³„: ${next.name}</div>
                            <div class="points-text" style="font-size: 12px; color: #333; font-weight: 600;">ëª©í‘œ: ${next.conditionValue}ì  (í˜„ì¬: ${userPoints}ì )</div>
                            <div class="progress-bar" data-target-points="${next.conditionValue}" style="width: 100%; height: 8px; background: #eee; border-radius: 4px; margin-top: 6px;">
                                <div class="progress-fill" style="width: ${progress}%; height: 100%; background: #4a90e2; border-radius: 4px;"></div>
                            </div>`;
                        badgeContainer.appendChild(wrap);
                    }

                } else {
                    // ê¸°ë³¸ ë¸Œë¡ ì¦ˆ ë±ƒì§€
                    showDefaultBronzeBadge(badgeContainer, userPoints);
                }
            }
        } catch (error) {
            console.error('ë±ƒì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
        }

        // --- í€´ì¦ˆ ë¬¸ì œ ë¡œë“œ ---
        const response = await fetch(`/api/quiz/short-answer?userId=${window.userId}`);
        const quiz = await response.json();
        const quizList = document.getElementById("quizList");

        quiz.items.forEach((item, index) => {
            const div = document.createElement("div");
            div.className = "quiz-card";
            div.id = `quiz_card_${index}`;
            div.setAttribute("data-term-id", item.termId);

            div.innerHTML = `
                <div class="quiz-level-box">
                    <span class="level-text">Lv.${item.level}</span>
                    <span class="result-icon" id="result_${item.termId}"></span>
                </div>
                <p><strong>Q${index + 1}. í•´ì„¤:</strong> ${item.question.replace(/\n/g, '<br>')}</p>
                <input type="text" id="answer_${index}" name="answer_${item.termId}" placeholder="ì •ë‹µ ì…ë ¥">
                <button type="button" onclick="
                    document.getElementById('hint_${index}').style.display = 'block';
                    this.style.display = 'none';
                ">ì´ˆì„± íŒíŠ¸ ë³´ê¸°</button>
                <div id="hint_${index}" class="hint" style="display: none;">
                    <em>ì´ˆì„± íŒíŠ¸:</em> ${item.initialHint}
                </div>
                <!-- ì •ë‹µë³´ê¸° ë²„íŠ¼ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€, ì œì¶œ í›„ ì˜¤ë‹µì¼ ë•Œ í‘œì‹œ) -->
                <button type="button" id="reveal_${index}" style="display:none; margin-top: 8px;">ì •ë‹µ ë³´ê¸°</button>
            `;
            quizList.appendChild(div);
        });
        // âœ… ì œì¶œ ì´ë²¤íŠ¸
        document.getElementById("quizForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const answers = {};
            for (let [key, value] of formData.entries()) {
                answers[key.replace("answer_", "")] = value.trim();
            }

            let result;
            try {
                const res = await fetch("/api/quiz/submit", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Accept": "application/json" },
                    body: JSON.stringify({ quizId: quiz.quizId, userId: window.userId, answers })
                });
                if (!res.ok) {
                    const errText = await res.text().catch(()=>"<no body>");
                    console.error("/api/quiz/submit ì‹¤íŒ¨", res.status, errText);
                    alert(`ì œì¶œ ì‹¤íŒ¨ (status ${res.status}). ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);
                    return;
                }
                result = await res.json();
            } catch (err) {
                console.error('ì œì¶œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜:', err);
                alert('ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            // âœ… ì±„ì  ê²°ê³¼ ë°˜ì˜ (ì •ë‹µë³´ê¸° ë²„íŠ¼ì€ ì˜¤ë‹µì¼ ë•Œë§Œ ë…¸ì¶œ, í´ë¦­ ì‹œ ì…ë ¥ì°½ì— ë¹¨ê°„ ê¸€ì”¨ë¡œ ì •ë‹µ í‘œê¸°)
            try {
                if (result && result.correctMap) {
                    Object.entries(result.correctMap).forEach(([termId, isCorrect]) => {
                        const card = document.querySelector(`.quiz-card[data-term-id="${termId}"]`);
                        const icon = document.getElementById(`result_${termId}`);
                        const inputEl = card ? card.querySelector("input[type='text']") : null;
                        if (card && icon && inputEl) {
                            card.classList.add(isCorrect ? "correct" : "incorrect");
                            icon.innerText = isCorrect ? "âœ”" : "âœ–";
                            icon.style.color = isCorrect ? "#007bff" : "#ff4d4f";

                            if (!isCorrect) {
                                const idx = card.id.replace("quiz_card_", "");
                                const revealBtn = document.getElementById(`reveal_${idx}`);
                                if (revealBtn) {
                                    revealBtn.style.display = 'inline-block';
                                    revealBtn.onclick = function() {
                                        inputEl.value = quiz.items[idx].term;
                                        inputEl.style.color = "#ff0000";  // ë¹¨ê°„ ê¸€ì”¨
                                        inputEl.style.fontWeight = "bold";
                                        revealBtn.disabled = true;
                                    };
                                }
                            }
                        }
                    });
                }
            } catch (e) {
                console.error('ì±„ì  ê²°ê³¼ ë°˜ì˜ ì¤‘ ì˜¤ë¥˜:', e, result);
            }

            // âœ… í¬ì¸íŠ¸ ê°±ì‹  & ê²Œì´ì§€ ì—…ë°ì´íŠ¸
            if (result && result.score > 0) {
                try {
                    const pointsRes = await fetch(`/api/users/${window.userId}/points`);
                    if (pointsRes.ok) {
                        const pointsData = await pointsRes.json();
                        const earned = result.score || 0;
                        const latestTotal = (typeof result.totalPoints === 'number' && result.totalPoints > 0)
                            ? result.totalPoints
                            : (pointsData.totalPoints || 0) + earned;

                        updateBadgeProgress(latestTotal);
                        showPointsNotification(earned, latestTotal);
                        await reloadBadges(latestTotal);
                        setTimeout(() => reloadBadges().catch(()=>{}), 200);
                    }
                } catch (error) {
                    console.error('í¬ì¸íŠ¸ ê°±ì‹  ì‹¤íŒ¨:', error);
                }
            }

            alert(`í€´ì¦ˆ ê²°ê³¼: ${result && typeof result.score === 'number' ? result.score : 0}ì \ní‹€ë¦° ë¬¸ì œë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!`);
        });

        // --- í•¨ìˆ˜ë“¤ ---

        // ê¸°ë³¸ ë¸Œë¡ ì¦ˆ ë±ƒì§€ ë…¸ì¶œ (í•¨ìˆ˜ ì„ ì–¸ì€ í˜¸ì´ìŠ¤íŒ…ë˜ì–´ ìƒë‹¨ í˜¸ì¶œê³¼ í˜¸í™˜)
        function showDefaultBronzeBadge(container, userPoints) {
            const badgeDiv = document.createElement('div');
            badgeDiv.style.cssText = `
                display: inline-block;
                margin: 5px;
                text-align: center;
                padding: 10px;
                border-radius: 8px;
                background: #ffffff;
                color: #333;
                box-shadow: 0 2px 4px rgba(0,0,0,0.12);
                border: 1px solid #eee;
            `;
            const img = document.createElement('img');
            img.src = '/img/bronze.png';
            img.alt = 'ë¸Œë¡ ì¦ˆ';
            img.style.cssText = 'width: 160px; height: 160px; margin-bottom: 12px; object-fit: contain;';
            badgeDiv.appendChild(img);
            const nameDiv = document.createElement('div');
            nameDiv.textContent = 'ë¸Œë¡ ì¦ˆ';
            nameDiv.style.cssText = 'font-size: 16px; font-weight: bold; margin-bottom: 5px;';
            badgeDiv.appendChild(nameDiv);
            // ë‹¤ìŒ ë‹¨ê³„(ì˜ˆ: ì‹¤ë²„) ê°„ë‹¨ ì•ˆë‚´ ê²Œì´ì§€
            const progressDiv = document.createElement('div');
            const target = 500; // ì˜ˆì‹œ ê°’ (ë°±ì—”ë“œ ì¡°ê±´ì— ë§ê²Œ ì¡°ì •)
            const progress = Math.min(100, (userPoints / target) * 100);
            progressDiv.innerHTML = `
                <div style="font-size: 12px; margin-bottom: 3px;">ë‹¤ìŒ ë‹¨ê³„: ì‹¤ë²„</div>
                <div class="points-text" style="font-size: 12px; color: #333; font-weight: 600;">ëª©í‘œ: ${target}ì  (í˜„ì¬: ${userPoints}ì )</div>
                <div class="progress-bar" data-target-points="${target}" style="width: 100%; height: 8px; background: #eee; border-radius: 4px; margin-top: 6px;">
                    <div class="progress-fill" style="width: ${progress}%; height: 100%; background: #4a90e2; border-radius: 4px;"></div>
                </div>
            `;
            badgeDiv.appendChild(progressDiv);
            container.appendChild(badgeDiv);
        }

        // ì§„í–‰ë¥  ë°” ê°’ë§Œ ì—…ë°ì´íŠ¸ (DOM ì¬êµ¬ì„± ì—†ì´)
        function updateBadgeProgress(totalPoints) {
            const badgeContainer = document.getElementById('badgeContainer');
            const progressBars = badgeContainer.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const targetPoints = parseInt(bar.dataset.targetPoints);
                const progress = Math.min(100, (totalPoints / targetPoints) * 100);
                const progressFill = bar.querySelector('.progress-fill');
                const pointsText = bar.parentElement ? bar.parentElement.querySelector('.points-text') : null;
                if (progressFill) progressFill.style.width = progress + '%';
                if (pointsText) pointsText.textContent = `ëª©í‘œ: ${targetPoints}ì  (í˜„ì¬: ${totalPoints}ì )`;
            });
        }

        // ì „ì²´ ë±ƒì§€ íŒ¨ë„ ì¬êµ¬ì„± (ë‹¤ìŒ ë‹¨ê³„ ê²Œì´ì§€ í¬í•¨)
        async function reloadBadges(totalOverride) {
            const badgeContainer = document.getElementById('badgeContainer');
            // ìµœì‹  í¬ì¸íŠ¸
            let totalPoints = typeof totalOverride === 'number' ? totalOverride : 0;
            if (typeof totalOverride !== 'number') {
                try {
                    const pointsRes = await fetch(`/api/users/${window.userId}/points`);
                    if (pointsRes.ok) {
                        const pointsData = await res.json();
                        totalPoints = pointsData.totalPoints || 0;
                    }
                } catch (e) {
                    console.error('í¬ì¸íŠ¸ ì¬ì¡°íšŒ ì‹¤íŒ¨:', e);
                }
            }

            try {
                const badgeRes = await fetch(`/api/users/${window.userId}/badges`);
                if (!badgeRes.ok) {
                    console.warn('ë±ƒì§€ API ì‘ë‹µ ì˜¤ë¥˜:', badgeRes.status);
                    return;
                }
                const badges = await badgeRes.json();
                const earnedBadges = badges.filter(b => b.earned);
                const earnedSet = new Set(earnedBadges.map(b => b.name));

                // íŒ¨ë„ ì´ˆê¸°í™”
                badgeContainer.innerHTML = '';

                if (earnedBadges.length > 0) {
                    // í˜„ì¬ ë“±ê¸‰ í—¤ë”
                    const rankOrder = ['ë¸Œë¡ ì¦ˆ','ì‹¤ë²„','ê³¨ë“œ','í”Œë˜í‹°ë„˜'];
                    const currentRank = earnedBadges
                        .filter(b => rankOrder.includes(b.name))
                        .sort((a,b) => rankOrder.indexOf(b.name) - rankOrder.indexOf(a.name))[0];
                    if (currentRank) {
                        const header = document.createElement('div');
                        header.style.cssText = 'margin-bottom:10px; padding:8px 10px; background:#fff; border:1px solid #eee; border-radius:8px; display:flex; align-items:center; gap:10px;';
                        const img = document.createElement('img');
                        img.src = currentRank.imageUrl; img.alt = currentRank.name; img.style.cssText = 'width:36px; height:36px; object-fit:contain;';
                        const title = document.createElement('div');
                        title.innerHTML = `<strong>í˜„ì¬ ë“±ê¸‰:</strong> ${currentRank.name}`;
                        header.appendChild(img); header.appendChild(title);
                        badgeContainer.appendChild(header);
                    }

                    // ë³´ìœ  ë±ƒì§€ ì¹´ë“œ
                    earnedBadges.forEach(badge => {
                        const badgeDiv = document.createElement('div');
                        badgeDiv.style.cssText = `
                            display: inline-block;
                            margin: 5px;
                            text-align: center;
                            padding: 10px;
                            border-radius: 8px;
                            background: #ffffff;
                            color: #333;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.12);
                            border: 1px solid #eee;
                        `;
                        const img = document.createElement('img');
                        img.src = badge.imageUrl;
                        img.alt = badge.name;
                        img.style.cssText = 'width: 160px; height: 160px; margin-bottom: 12px; object-fit: contain;';
                        badgeDiv.appendChild(img);
                        const nameDiv = document.createElement('div');
                        nameDiv.textContent = badge.name;
                        nameDiv.style.cssText = 'font-size: 16px; font-weight: bold; margin-bottom: 5px;';
                        badgeDiv.appendChild(nameDiv);

                        // âœ… ì´ ë±ƒì§€ ë‹¤ìŒ ë‹¨ê³„ ê²Œì´ì§€ (ê°€ëŠ¥í•  ë•Œ)
                        const higher = badges
                            .filter(b => b.conditionValue > (badge.conditionValue || 0) && !earnedSet.has(b.name))
                            .sort((a,b) => a.conditionValue - b.conditionValue)[0];
                        if (higher) {
                            const progressDiv = document.createElement('div');
                            const progress = Math.min(100, (totalPoints / higher.conditionValue) * 100);
                            progressDiv.innerHTML = `
                                <div style="font-size: 12px; margin-bottom: 3px; color: #333;">ë‹¤ìŒ ë‹¨ê³„: ${higher.name}</div>
                                <div class="points-text" style="font-size: 12px; color: #333; font-weight: 600;">ëª©í‘œ: ${higher.conditionValue}ì  (í˜„ì¬: ${totalPoints}ì )</div>
                                <div class="progress-bar" data-target-points="${higher.conditionValue}" style="width: 100%; height: 8px; background: #eee; border-radius: 4px; margin-top: 6px;">
                                    <div class="progress-fill" style="width: ${progress}%; height: 100%; background: #4a90e2; border-radius: 4px;"></div>
                                </div>
                            `;
                            badgeDiv.appendChild(progressDiv);
                        }

                        badgeContainer.appendChild(badgeDiv);
                    });

                    // âœ… ë³´ìœ í•˜ì§€ ì•Šì€ ë‹¤ìŒ ë‹¨ê³„ê°€ ë”°ë¡œ ìˆì„ ê²½ìš°(ìƒë‹¨ ê³µí†µ ì§„í–‰ë¥ )
                    const next = badges.filter(b => !b.earned).sort((a,b)=>a.conditionValue-b.conditionValue)[0];
                    if (next) {
                        const wrap = document.createElement('div');
                        wrap.style.cssText = 'margin-top:8px; background:#fff; border:1px solid #eee; border-radius:8px; padding:10px;';
                        const progress = Math.min(100, (totalPoints / next.conditionValue) * 100);
                        wrap.innerHTML = `
                            <div style="font-size: 12px; margin-bottom: 3px; color: #333;">ë‹¤ìŒ ë‹¨ê³„(ê³µí†µ): ${next.name}</div>
                            <div class="points-text" style="font-size: 12px; color: #333; font-weight: 600;">ëª©í‘œ: ${next.conditionValue}ì  (í˜„ì¬: ${totalPoints}ì )</div>
                            <div class="progress-bar" data-target-points="${next.conditionValue}" style="width: 100%; height: 8px; background: #eee; border-radius: 4px; margin-top: 6px;">
                                <div class="progress-fill" style="width: ${progress}%; height: 100%; background: #4a90e2; border-radius: 4px;"></div>
                            </div>`;
                        badgeContainer.appendChild(wrap);
                    }

                } else {
                    showDefaultBronzeBadge(badgeContainer, totalPoints);
                }

                // ìƒˆë¡œ íšë“í•œ ë±ƒì§€ ê°ì§€ (ê°„ë‹¨ ë¹„êµ)
                try {
                    const currentEarned = new Set(earnedBadges.map(b => b.name));
                    const newlyEarned = [...currentEarned].filter(n => !earnedBadgeNames.has(n));
                    if (newlyEarned.length > 0) {
                        showBadgeNotification(newlyEarned);
                    }
                    earnedBadgeNames = currentEarned;
                } catch (e) {
                    console.warn('ë±ƒì§€ ë¹„êµ ì¤‘ ì˜¤ë¥˜', e);
                }

                // ìµœì¢… ì§„í–‰ë¥  í…ìŠ¤íŠ¸/ê²Œì´ì§€ ìµœì‹ í™”
                updateBadgeProgress(totalPoints);

            } catch (e) {
                console.error('ë±ƒì§€ ì¬ì¡°íšŒ ì‹¤íŒ¨:', e);
            }
        }

        // í¬ì¸íŠ¸ íšë“ ì•Œë¦¼
        function showPointsNotification(earnedPoints, totalPoints) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #4CAF50, #45a049);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: slideIn 0.5s ease-out;
            `;
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">ğŸ‰ í¬ì¸íŠ¸ íšë“!</div>
                <div>+${earnedPoints}ì  íšë“</div>
                <div style="font-size: 12px; opacity: 0.8;">ì´ ${totalPoints}ì </div>
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.5s ease-in';
                setTimeout(() => { if (notification.parentNode) notification.parentNode.removeChild(notification); }, 500);
            }, 3000);
        }

        // ìƒˆ ë±ƒì§€ íšë“ ì•Œë¦¼
        function showBadgeNotification(badgeNames) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ff8a00, #e52e71);
                color: white;
                padding: 14px 18px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: slideIn 0.5s ease-out;
                max-width: 320px;
            `;
            const list = badgeNames.map(n => `ğŸ… ${n}`).join('<br>');
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 6px;">ìƒˆ ë±ƒì§€ íšë“!</div>
                <div style="font-size: 13px; line-height: 1.4;">${list}</div>
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.5s ease-in';
                setTimeout(() => { if (notification.parentNode) notification.parentNode.removeChild(notification); }, 500);
            }, 3500);
        }

        // CSS ì• ë‹ˆë©”ì´ì…˜
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    };
</script>
</body>
</html>
